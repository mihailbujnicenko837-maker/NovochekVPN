<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>City VPN - New Year</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007AFF; 
            --bg-color: #0f0f13;
            --card-bg: rgba(255, 255, 255, 0.08);
            --text-color: #ffffff;
            --success-color: #32d74b;
            --danger-color: #ff453a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            /* –ó–∏–º–Ω–∏–π –Ω–æ—á–Ω–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç */
            background-image: radial-gradient(circle at 50% 0%, #1a2a6c 0%, #b21f1f 100%);
            background-size: cover;
            background-attachment: fixed;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
            overflow-x: hidden;
            position: relative;
        }

        /* --- ‚ùÑÔ∏è –°–ù–ï–ì --- */
        #snow-canvas {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        /* --- üéÑ –ì–ò–†–õ–Ø–ù–î–ê --- */
        .lightrope {
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            position: absolute;
            z-index: 10;
            top: -15px;
            width: 100%;
            margin: 0; padding: 0;
            pointer-events: none;
            display: flex;
            justify-content: center;
        }
        .lightrope li {
            position: relative;
            list-style: none;
            margin: 0 12px;
            padding: 0;
            display: block;
            width: 12px; height: 12px;
            border-radius: 50%;
            background: #fff;
            animation-fill-mode: both;
            animation-iteration-count: infinite;
        }
        /* –ü—Ä–æ–≤–æ–¥ */
        .lightrope li:before {
            content: "";
            position: absolute;
            background: #222;
            width: 30px; height: 2px;
            border-radius: 50%;
            top: -2px; left: -14px;
            z-index: -1;
        }
        .lightrope li:nth-child(2n+1) { background: #00ff22; box-shadow: 0 2px 15px #00ff22; animation: flash 2s infinite alternate; }
        .lightrope li:nth-child(4n+2) { background: #ff0015; box-shadow: 0 2px 15px #ff0015; animation: flash 2.5s infinite alternate; }
        .lightrope li:nth-child(3n+4) { background: #00eaff; box-shadow: 0 2px 15px #00eaff; animation: flash 1.5s infinite alternate; }
        @keyframes flash { 0% { opacity: 1; transform: scale(1.1); } 100% { opacity: 0.4; transform: scale(0.9); } }

        /* --- –ö–û–ù–¢–ï–ô–ù–ï–† --- */
        .content {
            position: relative;
            z-index: 5;
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            margin-top: 30px;
        }
        .user-welcome { font-weight: 800; font-size: 20px; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .geo-badge {
            background: rgba(255, 255, 255, 0.15);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            backdrop-filter: blur(5px);
            display: flex; align-items: center; gap: 5px;
        }

        /* --- –°–¢–ê–¢–£–° --- */
        .status-card {
            width: 100%;
            background: rgba(20, 20, 25, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 30px 20px;
            text-align: center;
            border: 1px solid rgba(255, 59, 48, 0.3); /* –ö—Ä–∞—Å–Ω–∞—è —Ä–∞–º–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        .status-icon { font-size: 48px; margin-bottom: 15px; color: var(--danger-color); transition: 0.3s; }
        .status-text { font-size: 19px; font-weight: 700; margin-bottom: 8px; }
        .ip-badge {
            font-size: 13px;
            background: rgba(255, 59, 48, 0.15);
            color: #ff6b6b;
            padding: 6px 12px;
            border-radius: 8px;
            display: inline-block;
            margin-bottom: 10px;
            font-family: monospace;
        }
        .sub-text { font-size: 13px; color: rgba(255, 255, 255, 0.6); }

        /* --- –ö–ù–û–ü–ö–ê –ö–£–ü–ò–¢–¨ --- */
        .main-btn {
            background: linear-gradient(135deg, #007AFF, #00C6FF);
            border: none;
            width: 100%;
            padding: 18px;
            border-radius: 16px;
            color: white;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 122, 255, 0.3);
            transition: transform 0.1s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }
        .main-btn:active { transform: scale(0.97); }
        /* –ë–ª–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫–µ */
        .main-btn::after {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: rotate(45deg); animation: shine 3s infinite;
        }
        @keyframes shine { 0% { left: -100%; } 20% { left: 100%; } 100% { left: 100%; } }

        /* --- –°–°–´–õ–ö–ò --- */
        .section-label {
            margin: 25px 0 10px 0;
            font-size: 12px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 1px; width: 100%;
        }
        .quick-actions {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%;
        }
        .action-card {
            background: rgba(255,255,255,0.05);
            border-radius: 14px;
            padding: 12px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
        }
        .action-card:active { background: rgba(255, 255, 255, 0.1); }
        .action-card i { font-size: 22px; margin-bottom: 5px; color: #fff; }
        .action-card span { font-size: 11px; color: rgba(255, 255, 255, 0.7); }

        /* --- –ù–ò–ñ–ù–ò–ï –ö–ù–û–ü–ö–ò --- */
        .footer-btns { display: flex; gap: 10px; width: 100%; margin-top: 15px; margin-bottom: 20px; }
        .btn-outline {
            flex: 1;
            background: transparent;
            border: 1px solid rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 12px;
            color: #ccc;
            font-size: 13px;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }

        /* --- –ú–û–î–ê–õ–ö–ê –ò–ù–°–¢–†–£–ö–¶–ò–ò --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            display: none; justify-content: center; align-items: center;
            padding: 20px; backdrop-filter: blur(8px);
        }
        .modal {
            background: #1c1c1e;
            width: 100%; max-width: 340px;
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .modal h3 { margin-top: 0; color: #fff; text-align: center; }
        .step { display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-start; }
        .step-num {
            background: var(--primary-color);
            min-width: 24px; height: 24px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: bold; margin-top: 2px;
        }
        .step-text { font-size: 13px; line-height: 1.4; color: #ccc; }
        .close-modal {
            background: #333; border: none; width: 100%; padding: 12px;
            border-radius: 12px; color: #fff; margin-top: 15px; font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

    <canvas id="snow-canvas"></canvas>
    <ul class="lightrope">
        <li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
    </ul>

    <div class="content">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="user-welcome">–ü—Ä–∏–≤–µ—Ç, <span id="username">...</span> üëã</div>
            <div class="geo-badge">
                <i class="fas fa-location-arrow"></i> <span id="cityText">...</span>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å -->
        <div class="status-card" id="statusCard">
            <div class="status-icon"><i class="fas fa-unlock-alt"></i></div>
            <div class="status-text">–í—ã –Ω–µ –∑–∞—â–∏—â–µ–Ω—ã</div>
            <div class="ip-badge" id="ipText">IP: –û–ø—Ä–µ–¥–µ–ª—è–µ–º...</div>
            <div class="sub-text">–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –ø–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å</div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –∫—É–ø–∏—Ç—å -->
        <button class="main-btn" onclick="startPaymentProcess()" id="mainBtn">
            <i class="fas fa-shield-alt"></i> –ö–£–ü–ò–¢–¨ –ó–ê–©–ò–¢–£
        </button>

        <div class="section-label">–°–∫–∞—á–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</div>
        <div class="quick-actions">
            <div class="action-card" onclick="tg.openLink('https://apps.apple.com/ru/app/v2raytun/id6476628951')">
                <i class="fab fa-apple"></i> <span>iPhone</span>
            </div>
            <div class="action-card" onclick="tg.openLink('https://play.google.com/store/apps/details?id=com.v2raytun.android')">
                <i class="fab fa-android"></i> <span>Android</span>
            </div>
        </div>

        <div class="footer-btns">
            <button class="btn-outline" onclick="openInstruction()">
                <i class="fas fa-book"></i> –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
            </button>
            <button class="btn-outline" onclick="openSupport()">
                <i class="fas fa-headset"></i> –ü–æ–¥–¥–µ—Ä–∂–∫–∞
            </button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ -->
    <div class="modal-overlay" id="instructionModal">
        <div class="modal">
            <h3>üöÄ –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å?</h3>
            <div class="step">
                <div class="step-num">1</div>
                <div class="step-text">–ù–∞–∂–º–∏—Ç–µ <b>"–ö—É–ø–∏—Ç—å –∑–∞—â–∏—Ç—É"</b>. –í–∞—Å –ø–µ—Ä–µ–∫–∏–Ω–µ—Ç –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.</div>
            </div>
            <div class="step">
                <div class="step-num">2</div>
                <div class="step-text">–û–ø–ª–∞—Ç–∏—Ç–µ —Ç–∞—Ä–∏—Ñ –∏ –ø–æ–ª—É—á–∏—Ç–µ <b>–ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞</b> (–æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å <code>vless://...</code>).</div>
            </div>
            <div class="step">
                <div class="step-num">3</div>
                <div class="step-text">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ <b>V2RayTun</b>.</div>
            </div>
            <div class="step">
                <div class="step-num">4</div>
                <div class="step-text">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–∞–º–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á. –ù–∞–∂–º–∏—Ç–µ "–ò–º–ø–æ—Ä—Ç" –∏ –∫–Ω–æ–ø–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.</div>
            </div>
            <button class="close-modal" onclick="closeInstruction()">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- –ù–ê–°–¢–†–û–ô–ö–ò (–ü–û–ú–ï–ù–Ø–ô –°–°–´–õ–ö–£!) ---
        // –°—é–¥–∞ –≤—Å—Ç–∞–≤—å —Å—Å—ã–ª–∫—É –Ω–∞ –æ–ø–ª–∞—Ç—É –ò–õ–ò –Ω–∞ —Å–≤–æ–π –ª–∏—á–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å/–±–æ—Ç —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏
        // –ù–∞–ø—Ä–∏–º–µ—Ä: 'https://t.me/Ajdaha61' –∏–ª–∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ YooMoney
        const PAYMENT_URL = 'https://t.me/Ajdaha61?text=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –•–æ—á—É –∫—É–ø–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ VPN'; 

        // 1. User & Geo
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            document.getElementById('username').innerText = tg.initDataUnsafe.user.first_name;
        }

        fetch('https://get.geojs.io/v1/ip/geo.json')
            .then(res => res.json())
            .then(data => {
                document.getElementById('cityText').innerText = data.city || "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç";
                document.getElementById('ipText').innerText = "IP: " + data.ip;
            })
            .catch(() => {
                document.getElementById('cityText').innerText = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
            });

        // 2. –õ–æ–≥–∏–∫–∞ "–û–ø–ª–∞—Ç—ã" –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞
        function startPaymentProcess() {
            const btn = document.getElementById('mainBtn');
            const originalContent = btn.innerHTML;

            // –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...';
            btn.style.opacity = '0.8';

            setTimeout(() => {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–Ω–æ–ø–∫—É –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É
                btn.innerHTML = originalContent;
                btn.style.opacity = '1';
                
                // –í–∏–±—Ä–∞—Ü–∏—è (–ø—Ä–∏—è—Ç–Ω–æ)
                tg.HapticFeedback.notificationOccurred('success');

                // –û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–∏–∞–ª–æ–≥ –¥–ª—è –æ–ø–ª–∞—Ç—ã
                tg.openTelegramLink(PAYMENT_URL);
            }, 800);
        }

        // 3. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
        function openInstruction() {
            document.getElementById('instructionModal').style.display = 'flex';
            tg.BackButton.show();
            tg.BackButton.onClick(closeInstruction);
        }
        function closeInstruction() {
            document.getElementById('instructionModal').style.display = 'none';
            tg.BackButton.hide();
        }

        // 4. –ü–æ–¥–¥–µ—Ä–∂–∫–∞
        function openSupport() {
            tg.openTelegramLink('https://t.me/Ajdaha61');
        }

        // 5. ‚ùÑÔ∏è –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –°–ù–ï–ì
        (function() {
            const canvas = document.getElementById('snow-canvas');
            const ctx = canvas.getContext('2d');
            let w = window.innerWidth, h = window.innerHeight;
            canvas.width = w; canvas.height = h;

            const flakes = Array.from({length: 50}, () => ({
                x: Math.random() * w, y: Math.random() * h,
                r: Math.random() * 3 + 1, d: Math.random() * 50
            }));

            function draw() {
                ctx.clearRect(0, 0, w, h);
                ctx.fillStyle = "rgba(255, 255, 255, 0.6)";
                ctx.beginPath();
                flakes.forEach(f => {
                    ctx.moveTo(f.x, f.y);
                    ctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
                });
                ctx.fill();
                update();
                requestAnimationFrame(draw);
            }

            let angle = 0;
            function update() {
                angle += 0.01;
                flakes.forEach((f, i) => {
                    f.y += Math.cos(angle + f.d) + 1 + f.r/2;
                    f.x += Math.sin(angle) * 2;
                    if (f.y > h) { flakes[i] = {x: Math.random()*w, y: -10, r: f.r, d: f.d}; }
                });
            }
            draw();
            window.addEventListener('resize', () => { w=window.innerWidth; h=window.innerHeight; canvas.width=w; canvas.height=h; });
        })();
    </script>
</body>
</html>
